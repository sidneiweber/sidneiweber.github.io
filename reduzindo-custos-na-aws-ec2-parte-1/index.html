<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=pt-br><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Reduzindo custos na AWS (EC2) - Parte 1 - Sidnei Weber</title><meta name=author content="Sidnei Weber"><meta name=author-link content><meta name=description content="A redução de custos no ambiente de nuvem é um assunto constante, a utlização é simples porém o desperdício de recursos pode ocorrer com bastante facilidade. Para te ajudar vou dividir as dicas em três partes, dividindo em EC2, ECS e RDS, três serviços distintos da [AWS](https://aws.amazon.com/pt/)."><meta name=keywords content="aws,ec2"><meta itemprop=name content="Reduzindo custos na AWS (EC2) - Parte 1"><meta itemprop=description content="A redução de custos no ambiente de nuvem é um assunto constante, a utlização é simples porém o desperdício de recursos pode ocorrer com bastante facilidade. Para te ajudar vou dividir as dicas em três partes, dividindo em EC2, ECS e RDS, três serviços distintos da [AWS](https://aws.amazon.com/pt/)."><meta itemprop=datePublished content="2021-02-16T09:27:08-03:00"><meta itemprop=dateModified content="2021-02-16T09:27:08-03:00"><meta itemprop=wordCount content="592"><meta itemprop=image content="https://sidneiweber.com.br/logo.png"><meta itemprop=keywords content="aws,ec2,"><meta property="og:title" content="Reduzindo custos na AWS (EC2) - Parte 1"><meta property="og:description" content="A redução de custos no ambiente de nuvem é um assunto constante, a utlização é simples porém o desperdício de recursos pode ocorrer com bastante facilidade. Para te ajudar vou dividir as dicas em três partes, dividindo em EC2, ECS e RDS, três serviços distintos da [AWS](https://aws.amazon.com/pt/)."><meta property="og:type" content="article"><meta property="og:url" content="https://sidneiweber.com.br/reduzindo-custos-na-aws-ec2-parte-1/"><meta property="og:image" content="https://sidneiweber.com.br/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-02-16T09:27:08-03:00"><meta property="article:modified_time" content="2021-02-16T09:27:08-03:00"><meta property="og:site_name" content="Sidnei Weber"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sidneiweber.com.br/logo.png"><meta name=twitter:title content="Reduzindo custos na AWS (EC2) - Parte 1"><meta name=twitter:description content="A redução de custos no ambiente de nuvem é um assunto constante, a utlização é simples porém o desperdício de recursos pode ocorrer com bastante facilidade. Para te ajudar vou dividir as dicas em três partes, dividindo em EC2, ECS e RDS, três serviços distintos da [AWS](https://aws.amazon.com/pt/)."><meta name=application-name content="Sidnei Weber"><meta name=apple-mobile-web-app-title content="Sidnei Weber"><meta name=theme-color data-light=#ffffff data-dark=#ffffff content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://sidneiweber.com.br/reduzindo-custos-na-aws-ec2-parte-1/><link rel=prev href=https://sidneiweber.com.br/criando-araquivo-swap-linux/><link rel=next href=https://sidneiweber.com.br/simular-trafego-usuario-servidor/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Reduzindo custos na AWS (EC2) - Parte 1","inLanguage":"pt-br","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/sidneiweber.com.br\/reduzindo-custos-na-aws-ec2-parte-1\/"},"image":["https:\/\/sidneiweber.com.br\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"aws, ec2","wordcount":592,"url":"https:\/\/sidneiweber.com.br\/reduzindo-custos-na-aws-ec2-parte-1\/","datePublished":"2021-02-16T09:27:08-03:00","dateModified":"2021-02-16T09:27:08-03:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/sidneiweber.com.br\/images\/avatar.png"},"author":{"@type":"Person","name":"Sidnei Weber"},"description":"A redução de custos no ambiente de nuvem é um assunto constante, a utlização é simples porém o desperdício de recursos pode ocorrer com bastante facilidade. Para te ajudar vou dividir as dicas em três partes, dividindo em EC2, ECS e RDS, três serviços distintos da [AWS](https://aws.amazon.com/pt/)."}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Sidnei Weber"><span class=header-title-pre><i class='fas fa-user-astronaut fa-fw' aria-hidden=true></i></span><span id=typeit-header-desktop class=typeit></span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-tent fa-fw fa-sm" aria-hidden=true></i> Artigos</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class="menu-item has-children"><a class=menu-link href=/#><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden=true></i> Ferramentas</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/gerador-senhas/><i class="fa-solid fa-lock fa-fw fa-sm" aria-hidden=true></i> Gerador de senhas</a></li></ul></li><li class=menu-item><a class=menu-link href=/guia-rapido/><i class="fa-solid fa-truck-fast fa-fw fa-sm" aria-hidden=true></i> Guia Rápido</a></li><li class=menu-item><a class=menu-link href=/sobre/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> Sobre</a></li><li class=menu-item><a class=menu-link href=https://github.com/sidneiweber title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Pesquisar títulos ou conteúdos ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Pesquisa><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Limpar><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Trocar tema"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label="Selecione o idioma" title="Selecione o idioma"><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item>Não há mais traduções</li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Sidnei Weber"><span class=header-title-pre><i class='fas fa-user-astronaut fa-fw' aria-hidden=true></i></span><span id=typeit-header-title-mobile class=typeit></span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Pesquisar títulos ou conteúdos ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Pesquisa><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Limpar><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancelar</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-tent fa-fw fa-sm" aria-hidden=true></i> Artigos</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/#><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden=true></i> Ferramentas</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/gerador-senhas/><i class="fa-solid fa-lock fa-fw fa-sm" aria-hidden=true></i> Gerador de senhas</a></li></ul></li><li class=menu-item><a class=menu-link href=/guia-rapido/><i class="fa-solid fa-truck-fast fa-fw fa-sm" aria-hidden=true></i> Guia Rápido</a></li><li class=menu-item><a class=menu-link href=/sobre/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> Sobre</a></li><li class=menu-item><a class=menu-link href=https://github.com/sidneiweber title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Trocar tema"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label="Selecione o idioma" title="Selecione o idioma">Português<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option disabled>Não há mais traduções</option></select></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class=toc id=toc-auto></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Reduzindo custos na AWS (EC2) - Parte 1</span></h1><p class="single-subtitle animate__animated animate__fadeIn">Usando o desligamento programado podemos reduzir custos.</p></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Sidnei Weber</span></span></div><div class=post-meta-line><span title="publicado em 2021-02-16 09:27:08"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=16/02/2021>16/02/2021</time></span>&nbsp;<span title="Atualizado em 2021-02-16 09:27:08"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=16/02/2021>16/02/2021</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>592 palavras</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>3 minutos</span>&nbsp;</div></div><div class=content id=content><p>A redução de custos no ambiente de nuvem é um assunto constante, a utlização é simples porém o desperdício de recursos pode ocorrer com bastante facilidade. Para te ajudar vou dividir as dicas em três partes, dividindo em EC2, ECS e RDS, três serviços distintos da <a href=https://aws.amazon.com/pt/ target=_blank rel="external nofollow noopener noreferrer">AWS</a>.</p><p>Na primeira parte começaremos com o EC2, que permite a criação de instâncias (&ldquo;máquinas virtuais&rdquo;) com facilidade, podendo ser usado tanto com Windows, quanto com Linux. Bom pra quem ainda não sabe, os recursos da AWS são cobrados por uso, então quando criamos uma instância no EC2, ela será cobrada pelo tempo que estiver ligada e veria de valor dependendo da <a href=https://aws.amazon.com/pt/ec2/instance-types/ target=_blank rel="external nofollow noopener noreferrer">tipo de instância escolhida</a>.</p><p>Bom a dica pode ser usada por quem utiliza os recursos EC2 durante o expediente de trabalho, seja em produção, que precise estar funcionando somente no horário de trabalho ou ambientes de desenvolvimento, que geralmente são usados por um determinado periodo do dia. A gente irá programar o start/stop dessas instâncias. Iremos utlizar funções <a href=https://aws.amazon.com/pt/lambda/ target=_blank rel="external nofollow noopener noreferrer">Lambdas</a> combinadas com <a href=https://docs.aws.amazon.com/pt_br/AmazonCloudWatch/latest/events/WhatIsCloudWatchEvents.html target=_blank rel="external nofollow noopener noreferrer">eventos do Cloudwatch</a>.</p><p>Precisaremos de uma função IAM com permissão para acessar os recursos EC2. Pode usar o nome que achar melhor. Aqui vai uma colinha da política, lembrando que a função precisa ser configurada com o serviço Lambda:</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Version&#34;</span><span class=p>:</span> <span class=s2>&#34;2012-10-17&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;Statement&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Sid&#34;</span><span class=p>:</span> <span class=s2>&#34;VisualEditor0&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;ec2:StartInstances&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;ec2:StopInstances&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;logs:PutLogEvents&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;arn:aws:logs:*:*:log-group:*:*:*&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;arn:aws:ec2:*:*:instance/*&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Sid&#34;</span><span class=p>:</span> <span class=s2>&#34;VisualEditor1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;ec2:DescribeInstances&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;*&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Sid&#34;</span><span class=p>:</span> <span class=s2>&#34;VisualEditor2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Effect&#34;</span><span class=p>:</span> <span class=s2>&#34;Allow&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Action&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;logs:CreateLogStream&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;logs:PutLogEvents&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=nt>&#34;Resource&#34;</span><span class=p>:</span> <span class=s2>&#34;arn:aws:logs:*:*:log-group:*&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div><p>Acessando Lambda no Console da AWS, clicaremos em criar uma função:
<img loading=lazy src=/img/aws/1.png srcset="/img/aws/1.png, /img/aws/1.png 1.5x, /img/aws/1.png 2x" sizes=auto data-title="Criar função" data-alt="Criar função" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>Iremos escolher a opção para criar do zero, escolheremos um nome, a linguagem Python 2.7, usar uma função existente e escolher a função IAM criada anteriormente. A primeira função será para realizar o stop das instâncias.
<img loading=lazy src=/img/aws/2.png srcset="/img/aws/2.png, /img/aws/2.png 1.5x, /img/aws/2.png 2x" sizes=auto data-title=/img/aws/2.png data-alt=/img/aws/2.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>No código da função (imagem abaixo) iremos alterar para o seguinte código, lembrando de alterar na linha 3 a região utilizada e na linha 5 os seus Instances IDs, se tiver mais de um basta separar por vírgula:</p><p><img loading=lazy src=/img/aws/3.png srcset="/img/aws/3.png, /img/aws/3.png 1.5x, /img/aws/3.png 2x" sizes=auto data-title=/img/aws/3.png data-alt=/img/aws/3.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=c1># Enter the region your instances are in e.g., &#39;eu-west-1&#39;</span>
</span></span><span class=line><span class=cl><span class=n>region</span> <span class=o>=</span> <span class=s1>&#39;us-east-1&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># Enter your instance IDs here</span>
</span></span><span class=line><span class=cl><span class=n>instances</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;i-02fb6a97792f0802a&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>lambda_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ec2</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;ec2&#39;</span><span class=p>,</span> <span class=n>region_name</span><span class=o>=</span><span class=n>region</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ec2</span><span class=o>.</span><span class=n>stop_instances</span><span class=p>(</span><span class=n>InstanceIds</span><span class=o>=</span><span class=n>instances</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span> <span class=s1>&#39;Instances are now stopped: &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>instances</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>Usandos os mesmos passos já podemos criar a função lambda para iniciar as instâncias, bastando mudar o código da função:</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>boto3</span>
</span></span><span class=line><span class=cl><span class=c1># Enter the region your instances are in e.g., &#39;eu-west-1&#39;</span>
</span></span><span class=line><span class=cl><span class=n>region</span> <span class=o>=</span> <span class=s1>&#39;us-east-1&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># Enter your instance IDs here</span>
</span></span><span class=line><span class=cl><span class=n>instances</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;i-02fb6a97792f0802a&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>lambda_handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>ec2</span> <span class=o>=</span> <span class=n>boto3</span><span class=o>.</span><span class=n>client</span><span class=p>(</span><span class=s1>&#39;ec2&#39;</span><span class=p>,</span> <span class=n>region_name</span><span class=o>=</span><span class=n>region</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ec2</span><span class=o>.</span><span class=n>start_instances</span><span class=p>(</span><span class=n>InstanceIds</span><span class=o>=</span><span class=n>instances</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span> <span class=s1>&#39;Instances started: &#39;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>instances</span><span class=p>)</span></span></span></code></pre></td></tr></table></div></div><p>Agora vamos a criação do gatilho para acionar os eventos do Cloudwatch. Clicando em adicionar gatilho, vamos escolher a opção Eventos do Cloudwatch.</p><p><img loading=lazy src=/img/aws/4.png srcset="/img/aws/4.png, /img/aws/4.png 1.5x, /img/aws/4.png 2x" sizes=auto data-title=/img/aws/4.png data-alt=/img/aws/4.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'>
<img loading=lazy src=/img/aws/5.png srcset="/img/aws/5.png, /img/aws/5.png 1.5x, /img/aws/5.png 2x" sizes=auto data-title=/img/aws/5.png data-alt=/img/aws/5.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>Vamos criar uma nova regra para esse gatilho, dando um nome e escolhendo a Expressão de programação, que é uma expressão Cron. Não esquecendo que esse cron é ajustado para UTC. Podemos adicionar o gatilho</p><p><img loading=lazy src=/img/aws/6.png srcset="/img/aws/6.png, /img/aws/6.png 1.5x, /img/aws/6.png 2x" sizes=auto data-title=/img/aws/6.png data-alt=/img/aws/6.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>Faremos o mesmo na função de Start</p><p><img loading=lazy src=/img/aws/7.png srcset="/img/aws/7.png, /img/aws/7.png 1.5x, /img/aws/7.png 2x" sizes=auto data-title=/img/aws/7.png data-alt=/img/aws/7.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>E está pronto, nos horários programados as instâncias definidas irão ser desligadas e ligadas, reduzindo o custo nesse tempo que irá permanecer desligadas. Qualquer dúvida ou correção basta deixar nos comentários :).</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Atualizado em 2021-02-16 09:27:08">Atualizado em 16/02/2021&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/reduzindo-custos-na-aws-ec2-parte-1/index.md title="Leia em Markdown" class=link-to-markdown>Leia em Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Compartilhe em Twitter" data-sharer=twitter data-url=https://sidneiweber.com.br/reduzindo-custos-na-aws-ec2-parte-1/ data-title="Reduzindo custos na AWS (EC2) - Parte 1" data-hashtags=aws,ec2><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Facebook" data-sharer=facebook data-url=https://sidneiweber.com.br/reduzindo-custos-na-aws-ec2-parte-1/ data-hashtag=aws><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Linkedin" data-sharer=linkedin data-url=https://sidneiweber.com.br/reduzindo-custos-na-aws-ec2-parte-1/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em WhatsApp" data-sharer=whatsapp data-url=https://sidneiweber.com.br/reduzindo-custos-na-aws-ec2-parte-1/ data-title="Reduzindo custos na AWS (EC2) - Parte 1" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Evernote" data-sharer=evernote data-url=https://sidneiweber.com.br/reduzindo-custos-na-aws-ec2-parte-1/ data-title="Reduzindo custos na AWS (EC2) - Parte 1"><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Trello" data-sharer=trello data-url=https://sidneiweber.com.br/reduzindo-custos-na-aws-ec2-parte-1/ data-title="Reduzindo custos na AWS (EC2) - Parte 1" data-description="A redução de custos no ambiente de nuvem é um assunto constante, a utlização é simples porém o desperdício de recursos pode ocorrer com bastante facilidade. Para te ajudar vou dividir as dicas em três partes, dividindo em EC2, ECS e RDS, três serviços distintos da [AWS](https://aws.amazon.com/pt/)."><i class="fa-brands fa-trello fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/aws/ class=post-tag>aws</a><a href=/tags/ec2/ class=post-tag>ec2</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Voltar</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/criando-araquivo-swap-linux/ class=post-nav-item rel=prev title="Criando arquivo de SWAP no Linux"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Criando arquivo de SWAP no Linux</a>
<a href=/simular-trafego-usuario-servidor/ class=post-nav-item rel=next title="Simular tráfego de usuário para um servidor">Simular tráfego de usuário para um servidor<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript rel="external nofollow noopener noreferrer">Disqus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">Possibilitado por <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.117.0">Hugo</a> | Tema - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2009 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/>Sidnei Weber</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Voltar ao topo"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label="Ver comentários"><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><noscript><div class=noscript-warning></div></noscript></div><script src=https://sidneiweber.disqus.com/embed.js defer></script><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js defer></script><script src=/lib/lunr/lunr.stemmer.support.min.js defer></script><script src=/lib/lunr/lunr.pt.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js async defer></script><script src=https://cdn.jsdelivr.net/npm/typeit@8.7.1/dist/index.umd.js defer></script><script>window.config={code:{copyTitle:"Copiar para a área de transferência",editLockTitle:"Bloquear bloco de código editável",editUnLockTitle:"Desbloqueie o bloco de código editável",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1},data:{"typeit-header-desktop":"Sidnei Weber","typeit-header-title-mobile":"Sidnei Weber"},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"pt",maxResultLength:10,noResultsFound:"Nenhum resultado encontrado",snippetLength:30,type:"lunr"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"typeit-header-desktop":["typeit-header-desktop"],"typeit-header-title-mobile":["typeit-header-title-mobile"]},duration:-1,loop:!1,speed:100}}</script><script src=/js/theme.min.js defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-332343290",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=G-332343290" async></script></body></html>