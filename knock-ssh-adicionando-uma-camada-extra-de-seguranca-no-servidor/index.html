<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=pt-br><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Knock SSH - Adicionando uma camada extra de segurança no servidor - Sidnei Weber</title><meta name=author content="Sidnei Weber"><meta name=author-link content><meta name=description content="Hoje vamos falar do Knock, uma ferramenta muito interessante para quem precisar acessar seus servidores remotamente. Bom o que o Knock faz, ele adiciona essa camada a mais da seguinte forma, por exemplo se acessamos nosso servidor pela porta 22 do ssh ela deveria estar liberada. Porém com Knock ela pode estar bloqueada, você acertando uma sequência específica de portas ele irá liberar a porta 22, e somente se acertar a sequencia definida."><meta name=keywords content="ssh,segurança"><meta itemprop=name content="Knock SSH - Adicionando uma camada extra de segurança no servidor"><meta itemprop=description content="Hoje vamos falar do Knock, uma ferramenta muito interessante para quem precisar acessar seus servidores remotamente. Bom o que o Knock faz, ele adiciona essa camada a mais da seguinte forma, por exemplo se acessamos nosso servidor pela porta 22 do ssh ela deveria estar liberada. Porém com Knock ela pode estar bloqueada, você acertando uma sequência específica de portas ele irá liberar a porta 22, e somente se acertar a sequencia definida."><meta itemprop=datePublished content="2017-03-21T16:03:09-03:00"><meta itemprop=dateModified content="2017-03-21T16:03:09-03:00"><meta itemprop=wordCount content="563"><meta itemprop=image content="https://sidneiweber.com.br/logo.png"><meta itemprop=keywords content="ssh,segurança,"><meta property="og:title" content="Knock SSH - Adicionando uma camada extra de segurança no servidor"><meta property="og:description" content="Hoje vamos falar do Knock, uma ferramenta muito interessante para quem precisar acessar seus servidores remotamente. Bom o que o Knock faz, ele adiciona essa camada a mais da seguinte forma, por exemplo se acessamos nosso servidor pela porta 22 do ssh ela deveria estar liberada. Porém com Knock ela pode estar bloqueada, você acertando uma sequência específica de portas ele irá liberar a porta 22, e somente se acertar a sequencia definida."><meta property="og:type" content="article"><meta property="og:url" content="https://sidneiweber.com.br/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor/"><meta property="og:image" content="https://sidneiweber.com.br/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-21T16:03:09-03:00"><meta property="article:modified_time" content="2017-03-21T16:03:09-03:00"><meta property="og:site_name" content="Sidnei Weber"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sidneiweber.com.br/logo.png"><meta name=twitter:title content="Knock SSH - Adicionando uma camada extra de segurança no servidor"><meta name=twitter:description content="Hoje vamos falar do Knock, uma ferramenta muito interessante para quem precisar acessar seus servidores remotamente. Bom o que o Knock faz, ele adiciona essa camada a mais da seguinte forma, por exemplo se acessamos nosso servidor pela porta 22 do ssh ela deveria estar liberada. Porém com Knock ela pode estar bloqueada, você acertando uma sequência específica de portas ele irá liberar a porta 22, e somente se acertar a sequencia definida."><meta name=application-name content="Sidnei Weber"><meta name=apple-mobile-web-app-title content="Sidnei Weber"><meta name=theme-color data-light=#ffffff data-dark=#ffffff content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://sidneiweber.com.br/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor/><link rel=prev href=https://sidneiweber.com.br/instalando-servidor-dhcp/><link rel=next href=https://sidneiweber.com.br/emmi-linux-uma-distribuicao-pequena-e-leve/><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Knock SSH - Adicionando uma camada extra de segurança no servidor","inLanguage":"pt-br","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/sidneiweber.com.br\/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor\/"},"image":["https:\/\/sidneiweber.com.br\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"ssh, segurança","wordcount":563,"url":"https:\/\/sidneiweber.com.br\/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor\/","datePublished":"2017-03-21T16:03:09-03:00","dateModified":"2017-03-21T16:03:09-03:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/sidneiweber.com.br\/images\/avatar.png"},"author":{"@type":"Person","name":"Sidnei Weber"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Sidnei Weber"><span class=header-title-pre><i class='fas fa-user-astronaut fa-fw' aria-hidden=true></i></span><span id=typeit-header-desktop class=typeit></span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-tent fa-fw fa-sm" aria-hidden=true></i> Artigos</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class="menu-item has-children"><a class=menu-link href=/#><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden=true></i> Ferramentas</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/gerador-senhas/><i class="fa-solid fa-lock fa-fw fa-sm" aria-hidden=true></i> Gerador de senhas</a></li></ul></li><li class=menu-item><a class=menu-link href=/guia-rapido/><i class="fa-solid fa-truck-fast fa-fw fa-sm" aria-hidden=true></i> Guia Rápido</a></li><li class=menu-item><a class=menu-link href=/sobre/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> Sobre</a></li><li class=menu-item><a class=menu-link href=https://github.com/sidneiweber title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Pesquisar títulos ou conteúdos ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Pesquisa><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Limpar><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Trocar tema"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label="Selecione o idioma" title="Selecione o idioma"><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item>Não há mais traduções</li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Sidnei Weber"><span class=header-title-pre><i class='fas fa-user-astronaut fa-fw' aria-hidden=true></i></span><span id=typeit-header-title-mobile class=typeit></span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Pesquisar títulos ou conteúdos ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Pesquisa><i class="fa-solid fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Limpar><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancelar</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-tent fa-fw fa-sm" aria-hidden=true></i> Artigos</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/#><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden=true></i> Ferramentas</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/gerador-senhas/><i class="fa-solid fa-lock fa-fw fa-sm" aria-hidden=true></i> Gerador de senhas</a></li></ul></li><li class=menu-item><a class=menu-link href=/guia-rapido/><i class="fa-solid fa-truck-fast fa-fw fa-sm" aria-hidden=true></i> Guia Rápido</a></li><li class=menu-item><a class=menu-link href=/sobre/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> Sobre</a></li><li class=menu-item><a class=menu-link href=https://github.com/sidneiweber title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Trocar tema"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label="Selecione o idioma" title="Selecione o idioma">Português<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option disabled>Não há mais traduções</option></select></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>Conteúdos&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Knock SSH - Adicionando uma camada extra de segurança no servidor</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Sidnei Weber</span></span></div><div class=post-meta-line><span title="publicado em 2017-03-21 16:03:09"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=21/03/2017>21/03/2017</time></span>&nbsp;<span title="Atualizado em 2017-03-21 16:03:09"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=21/03/2017>21/03/2017</time></span>&nbsp;<span><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i>563 palavras</span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>3 minutos</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Conteúdos</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><ul><li><a href=#no-servidor>No servidor</a></li><li><a href=#no-cliente>No cliente</a></li><li><a href=#fechando-a-porta>Fechando a porta</a></li></ul></li></ul></nav></div></div><div class=content id=content><p>Hoje vamos falar do <strong>Knock,</strong> uma ferramenta muito interessante para quem precisar acessar seus servidores remotamente. Bom o que o Knock faz, ele adiciona essa camada a mais da seguinte forma, por exemplo se acessamos nosso servidor pela porta 22 do ssh ela deveria estar liberada. Porém com Knock ela pode estar bloqueada, você acertando uma sequência específica de portas ele irá liberar a porta 22, e somente se acertar a sequencia definida.</p><h3 id=no-servidor>No servidor</h3><p>Precisamos instalar somente um pacote em nosso servidor:</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>apt-get install knockd</span></span></code></pre></td></tr></table></div></div><p>O arquivo de configuração fica no <strong><em>/etc/knockd.conf.</em></strong> Eis a configuração padrão que veio no Debian.</p><p><img loading=lazy src=/img/uploads/2017/03/Selecao_007.png srcset="/img/uploads/2017/03/Selecao_007.png, /img/uploads/2017/03/Selecao_007.png 1.5x, /img/uploads/2017/03/Selecao_007.png 2x" sizes=auto data-title="ssh &amp;gt;&amp;lt;" data-alt="ssh &amp;gt;&amp;lt;" style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></p><p>Eu alterei para a configuração ficar como no exemplo abaixo, sempre colocando a regra de ACCEPT na primeira linha, pois caso tenha sido bloqueada e seja adiciona no final do arquivo a regra não funcionará.</p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>options<span class=o>]</span>
</span></span><span class=line><span class=cl>        UseSyslog
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>openSSH<span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=nv>sequence</span>    <span class=o>=</span> 7000,8000,9000
</span></span><span class=line><span class=cl>        <span class=nv>seq_timeout</span> <span class=o>=</span> <span class=m>5</span>
</span></span><span class=line><span class=cl>        <span class=nb>command</span>     <span class=o>=</span> /sbin/iptables -I INPUT <span class=m>1</span> -s %IP% -p tcp --dport <span class=m>22</span> -j ACCEPT
</span></span><span class=line><span class=cl>        <span class=nv>tcpflags</span>    <span class=o>=</span> syn
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>closeSSH<span class=o>]</span>
</span></span><span class=line><span class=cl>        <span class=nv>sequence</span>    <span class=o>=</span> 9000,8000,7000
</span></span><span class=line><span class=cl>        <span class=nv>seq_timeout</span> <span class=o>=</span> <span class=m>5</span>
</span></span><span class=line><span class=cl>        <span class=nb>command</span>     <span class=o>=</span> /sbin/iptables -D INPUT -s %IP% -p tcp --dport <span class=m>22</span> -j ACCEPT
</span></span><span class=line><span class=cl>        <span class=nv>tcpflags</span>    <span class=o>=</span> syn</span></span></code></pre></td></tr></table></div></div><p>Após editaremos o arquivo <strong><em>/etc/default/knockd</em></strong> para especificar nossa placa de rede:</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>START_KNOCKD</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl><span class=nv>KNOCKD_OPTS</span><span class=o>=</span><span class=s2>&#34;-i enp0s3&#34;</span></span></span></code></pre></td></tr></table></div></div><p>Feito a configuração reiniciaremos o serviço:</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>/etc/init.d/knockd restart</span></span></code></pre></td></tr></table></div></div><p>Caso não tenha a porta 22 fechada, vamos fecha-lá. Lembrando que isso deve estar no script firewall do seu servidor.</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>iptables -A INPUT -p tcp --dport <span class=m>22</span> -j DROP</span></span></code></pre></td></tr></table></div></div><h3 id=no-cliente>No cliente</h3><p>No cliente instalaremos o mesmo utilitário, porém sem precisar fazer as configurações feitas anteriormente.</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>aptitude install knockd</span></span></code></pre></td></tr></table></div></div><p>Agora vamos bater nas portas em sequência conforme configurado no nosso servidor (7000, 8000, 9000)</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>knock 10.0.0.106 7000:tcp 8000:tcp 9000:tcp</span></span></code></pre></td></tr></table></div></div><p>Com as batidas corretamente executadas, podemos verificar o log do nosso servidor e veremos que o foi passado por 3 estágios e após os mesmos estarem corretos, nosso porta 22 foi liberada pelo firewall</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-s data-lang=s><span class=line><span class=cl><span class=n>Mar</span> <span class=m>21</span> <span class=m>15</span><span class=o>:</span><span class=m>49</span><span class=o>:</span><span class=m>21</span> <span class=n>server</span> <span class=n>knockd</span><span class=o>:</span> <span class=n>starting</span> <span class=n>up</span><span class=p>,</span> <span class=n>listening</span> <span class=n>on</span> <span class=n>enp0s3</span>
</span></span><span class=line><span class=cl><span class=n>Mar</span> <span class=m>21</span> <span class=m>15</span><span class=o>:</span><span class=m>49</span><span class=o>:</span><span class=m>26</span> <span class=n>server</span> <span class=n>knockd</span><span class=o>:</span> <span class=m>10.0.0.103</span><span class=o>:</span> <span class=n>openSSH</span><span class=o>:</span> <span class=n>Stage</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=n>Mar</span> <span class=m>21</span> <span class=m>15</span><span class=o>:</span><span class=m>49</span><span class=o>:</span><span class=m>26</span> <span class=n>server</span> <span class=n>knockd</span><span class=o>:</span> <span class=m>10.0.0.103</span><span class=o>:</span> <span class=n>openSSH</span><span class=o>:</span> <span class=n>Stage</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=n>Mar</span> <span class=m>21</span> <span class=m>15</span><span class=o>:</span><span class=m>49</span><span class=o>:</span><span class=m>26</span> <span class=n>server</span> <span class=n>knockd</span><span class=o>:</span> <span class=m>10.0.0.103</span><span class=o>:</span> <span class=n>openSSH</span><span class=o>:</span> <span class=n>Stage</span> <span class=m>3</span>
</span></span><span class=line><span class=cl><span class=n>Mar</span> <span class=m>21</span> <span class=m>15</span><span class=o>:</span><span class=m>49</span><span class=o>:</span><span class=m>26</span> <span class=n>server</span> <span class=n>knockd</span><span class=o>:</span> <span class=m>10.0.0.103</span><span class=o>:</span> <span class=n>openSSH</span><span class=o>:</span> <span class=n>OPEN</span> <span class=n>SESAME</span>
</span></span><span class=line><span class=cl><span class=n>Mar</span> <span class=m>21</span> <span class=m>15</span><span class=o>:</span><span class=m>49</span><span class=o>:</span><span class=m>26</span> <span class=n>server</span> <span class=n>knockd</span><span class=o>:</span> <span class=n>openSSH</span><span class=o>:</span> <span class=n>running</span> <span class=n>command</span><span class=o>:</span> <span class=o>/</span><span class=n>sbin</span><span class=o>/</span><span class=n>iptables</span> <span class=o>-</span><span class=n>I</span> <span class=n>INPUT</span> <span class=m>1</span> <span class=o>-</span><span class=n>s</span> <span class=m>10.0.0.103</span> <span class=o>-</span><span class=n>p</span> <span class=n>tcp</span> <span class=o>--</span><span class=n>dport</span> <span class=m>22</span> <span class=o>-</span><span class=n>j</span> <span class=n>ACCEPT</span></span></span></code></pre></td></tr></table></div></div><p>E assim podemos conectar normalmente sem bloqueio nenhum.</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ssh sidnei@10.0.0.106
</span></span><span class=line><span class=cl>sidnei@10.0.0.106<span class=err>&#39;</span>s password:</span></span></code></pre></td></tr></table></div></div><h3 id=fechando-a-porta>Fechando a porta</h3><p>Depois de fazer tudo que era necessário podemos fechar a porta novamente, acertando a sequência de fechamento que também é incluida no nosso arquivo de configuração do servidor.</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>knock 10.0.0.106 9000:tcp 8000:tcp 7000:tcp</span></span></code></pre></td></tr></table></div></div><p>E a porta será fechada novamente conforme o log nos informa:</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Mar 21 15:58:27 server knockd: 10.0.0.103: closeSSH: Stage 1
</span></span><span class=line><span class=cl>Mar 21 15:58:27 server knockd: 10.0.0.103: closeSSH: Stage 2
</span></span><span class=line><span class=cl>Mar 21 15:58:27 server knockd: 10.0.0.103: closeSSH: Stage 3
</span></span><span class=line><span class=cl>Mar 21 15:58:27 server knockd: 10.0.0.103: closeSSH: OPEN SESAME
</span></span><span class=line><span class=cl>Mar 21 15:58:27 server knockd: closeSSH: running command: /sbin/iptables -D INPUT -s 10.0.0.103 -p tcp --dport 22 -j ACCEPT</span></span></code></pre></td></tr></table></div></div><p>E era isso, acredito que seja uma camada bem interessante para nossos servidores e o mais importante, não colocando portas padrões na configuração, será muito mais dificil acertar a sequência para poder liberar o ssh.</p><p><a href="https://www.vivaolinux.com.br/artigo/KNOCK-+-SSH?pagina=1" target=_blank rel="external nofollow noopener noreferrer">Fonte</a></p><p>Um forte abraço</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Atualizado em 2017-03-21 16:03:09">Atualizado em 21/03/2017&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor/index.md title="Leia em Markdown" class=link-to-markdown>Leia em Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Compartilhe em Twitter" data-sharer=twitter data-url=https://sidneiweber.com.br/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor/ data-title="Knock SSH - Adicionando uma camada extra de segurança no servidor" data-hashtags=ssh,segurança><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Facebook" data-sharer=facebook data-url=https://sidneiweber.com.br/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor/ data-hashtag=ssh><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Linkedin" data-sharer=linkedin data-url=https://sidneiweber.com.br/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em WhatsApp" data-sharer=whatsapp data-url=https://sidneiweber.com.br/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor/ data-title="Knock SSH - Adicionando uma camada extra de segurança no servidor" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Evernote" data-sharer=evernote data-url=https://sidneiweber.com.br/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor/ data-title="Knock SSH - Adicionando uma camada extra de segurança no servidor"><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Trello" data-sharer=trello data-url=https://sidneiweber.com.br/knock-ssh-adicionando-uma-camada-extra-de-seguranca-no-servidor/ data-title="Knock SSH - Adicionando uma camada extra de segurança no servidor" data-description><i class="fa-brands fa-trello fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/ssh/ class=post-tag>ssh</a><a href=/tags/seguran%C3%A7a/ class=post-tag>segurança</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Voltar</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/instalando-servidor-dhcp/ class=post-nav-item rel=prev title="Instalando servidor DHCP"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Instalando servidor DHCP</a>
<a href=/emmi-linux-uma-distribuicao-pequena-e-leve/ class=post-nav-item rel=next title="Emmi Linux - Uma distribuição pequena e leve">Emmi Linux - Uma distribuição pequena e leve<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript rel="external nofollow noopener noreferrer">Disqus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">Possibilitado por <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.117.0">Hugo</a> | Tema - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2009 - 2023</span><span class=author itemprop=copyrightHolder>
<a href=/>Sidnei Weber</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Voltar ao topo"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label="Ver comentários"><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><noscript><div class=noscript-warning></div></noscript></div><script src=https://sidneiweber.disqus.com/embed.js defer></script><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js defer></script><script src=/lib/lunr/lunr.stemmer.support.min.js defer></script><script src=/lib/lunr/lunr.pt.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js async defer></script><script src=https://cdn.jsdelivr.net/npm/typeit@8.7.1/dist/index.umd.js defer></script><script>window.config={code:{copyTitle:"Copiar para a área de transferência",editLockTitle:"Bloquear bloco de código editável",editUnLockTitle:"Desbloqueie o bloco de código editável",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1},data:{"typeit-header-desktop":"Sidnei Weber","typeit-header-title-mobile":"Sidnei Weber"},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"pt",maxResultLength:10,noResultsFound:"Nenhum resultado encontrado",snippetLength:30,type:"lunr"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"typeit-header-desktop":["typeit-header-desktop"],"typeit-header-title-mobile":["typeit-header-title-mobile"]},duration:-1,loop:!1,speed:100}}</script><script src=/js/theme.min.js defer></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-332343290",{anonymize_ip:!0})</script><script src="https://www.googletagmanager.com/gtag/js?id=G-332343290" async></script></body></html>