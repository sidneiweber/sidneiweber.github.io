<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=pt-br><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-3P5DQB14L7"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-3P5DQB14L7")}</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=2"><meta name=robots content="noodp"><title>Como utilizar o Traefik como ingress controller no Kubernetes - Sidnei Weber</title><meta name=author content="Sidnei Weber">
<meta name=author-link content><meta name=description content=" O Traefik é uma ferramenta muito poderosa e uma ótima alternativa para utilizar como ingress controller/proxy reverso em seu cluster Kubernetes. Uma ferramenta super leve, escrita em go e com diversas funcionalidades adicionais incluídas por padrão "><meta name=keywords content='k8s,kubernetes,eks,traefik,ingress'><meta itemprop=name content="Como utilizar o Traefik como ingress controller no Kubernetes"><meta itemprop=description content=" O Traefik é uma ferramenta muito poderosa e uma ótima alternativa para utilizar como ingress controller/proxy reverso em seu cluster Kubernetes. Uma ferramenta super leve, escrita em go e com diversas funcionalidades adicionais incluídas por padrão "><meta itemprop=datePublished content="2024-03-22T10:20:00+00:00"><meta itemprop=dateModified content="2024-03-22T10:20:00+00:00"><meta itemprop=wordCount content="1211"><meta itemprop=image content="https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/featured-image.png"><meta itemprop=keywords content="K8s,Kubernetes,Eks,Traefik,Ingress"><meta property="og:url" content="https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/"><meta property="og:site_name" content="Sidnei Weber"><meta property="og:title" content="Como utilizar o Traefik como ingress controller no Kubernetes"><meta property="og:description" content=" O Traefik é uma ferramenta muito poderosa e uma ótima alternativa para utilizar como ingress controller/proxy reverso em seu cluster Kubernetes. Uma ferramenta super leve, escrita em go e com diversas funcionalidades adicionais incluídas por padrão "><meta property="og:locale" content="pt_br"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-22T10:20:00+00:00"><meta property="article:modified_time" content="2024-03-22T10:20:00+00:00"><meta property="article:tag" content="K8s"><meta property="article:tag" content="Kubernetes"><meta property="article:tag" content="Eks"><meta property="article:tag" content="Traefik"><meta property="article:tag" content="Ingress"><meta property="og:image" content="https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/featured-image.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/featured-image.png"><meta name=twitter:title content="Como utilizar o Traefik como ingress controller no Kubernetes"><meta name=twitter:description content=" O Traefik é uma ferramenta muito poderosa e uma ótima alternativa para utilizar como ingress controller/proxy reverso em seu cluster Kubernetes. Uma ferramenta super leve, escrita em go e com diversas funcionalidades adicionais incluídas por padrão "><meta name=application-name content="Sidnei Weber"><meta name=apple-mobile-web-app-title content="Sidnei Weber"><meta name=theme-color data-light=#ffffff data-dark=#ffffff content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/><link rel=prev href=https://sidneiweber.com.br/criando-api-rest-em-python-com-flask/><link rel=next href=https://sidneiweber.com.br/4-alternativas-ao-redis/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.removeAttribute("onload"),this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Como utilizar o Traefik como ingress controller no Kubernetes","inLanguage":"pt-br","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/sidneiweber.com.br\/como-utilizar-traefik-ingress-controller-no-kubernetes\/"},"image":[{"@type":"ImageObject","url":"https:\/\/sidneiweber.com.br\/como-utilizar-traefik-ingress-controller-no-kubernetes\/featured-image.png","width":1280,"height":720}],"genre":"posts","keywords":"k8s, kubernetes, eks, traefik, ingress","wordcount":1211,"url":"https:\/\/sidneiweber.com.br\/como-utilizar-traefik-ingress-controller-no-kubernetes\/","datePublished":"2024-03-22T10:20:00+00:00","dateModified":"2024-03-22T10:20:00+00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":"https:\/\/sidneiweber.com.br\/images\/avatar.png"},"author":{"@type":"Person","name":"Sidnei Weber"},"description":" O Traefik é uma ferramenta muito poderosa e uma ótima alternativa para utilizar como ingress controller/proxy reverso em seu cluster Kubernetes. Uma ferramenta super leve, escrita em go e com diversas funcionalidades adicionais incluídas por padrão "}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage?.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("data-theme","dark")</script><div class=wrapper data-page-style=normal><header class="desktop animate__faster" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="Sidnei Weber"><span class=header-title-pre><i class='fas fa-user-astronaut fa-fw' aria-hidden=true></i></span><span id=typeit-header-desktop class=typeit></span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-tent fa-fw fa-sm" aria-hidden=true></i> Artigos</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class="menu-item has-children"><a class=menu-link href=/#><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden=true></i> Ferramentas</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/gerador-senhas/><i class="fa-solid fa-lock fa-fw fa-sm" aria-hidden=true></i> Gerador de senhas</a></li></ul></li><li class="menu-item has-children"><a class=menu-link href=/guia-rapido/><i class="fa-solid fa-truck-fast fa-fw fa-sm" aria-hidden=true></i> Guia Rápido</a><i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i><ul class=sub-menu><li class=menu-item><a class=menu-link href=/guia-rapido-docker/ title="Guia Rápido Docker"><i class="fa-brands fa-docker fa-fw fa-sm" aria-hidden=true></i> Guia rápido Docker</a></li></ul></li><li class=menu-item><a class=menu-link href=/sobre/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> Sobre</a></li><li class=menu-item><a class=menu-link href=https://github.com/sidneiweber title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item delimiter"></li><li class="menu-item search" id=search-desktop><input type=text placeholder="Pesquisar títulos ou conteúdos ..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Pesquisa><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Limpar><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></li><li class="menu-item theme-switch" title="Trocar tema"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></li><li class="menu-item language-switch"><span role=button aria-label="Selecione o idioma" title="Selecione o idioma"><i class="fa-solid fa-language fa-fw" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item>Não há mais traduções</li></ul></li></ul></nav></div></header><header class="mobile animate__faster" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="Sidnei Weber"><span class=header-title-pre><i class='fas fa-user-astronaut fa-fw' aria-hidden=true></i></span><span id=typeit-header-title-mobile class=typeit></span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Pesquisar títulos ou conteúdos ..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Pesquisa><i class="fa-solid fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Limpar><i class="fa-solid fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fa-solid fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancelar</a></li><li class=menu-item><a class=menu-link href=/posts/><i class="fa-solid fa-tent fa-fw fa-sm" aria-hidden=true></i> Artigos</a></li><li class=menu-item><a class=menu-link href=/tags/><i class="fa-solid fa-tags fa-fw fa-sm" aria-hidden=true></i> Tags</a></li><li class=menu-item><span class=nested-item><a class=menu-link href=/#><i class="fa-solid fa-screwdriver-wrench fa-fw fa-sm" aria-hidden=true></i> Ferramentas</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/gerador-senhas/><i class="fa-solid fa-lock fa-fw fa-sm" aria-hidden=true></i> Gerador de senhas</a></li></ul></li><li class=menu-item><span class=nested-item><a class=menu-link href=/guia-rapido/><i class="fa-solid fa-truck-fast fa-fw fa-sm" aria-hidden=true></i> Guia Rápido</a>
<i class="dropdown-icon fa-solid fa-chevron-right" aria-hidden=true></i></span><ul class=sub-menu><li class=menu-item><a class=menu-link href=/guia-rapido-docker/ title="Guia Rápido Docker"><i class="fa-brands fa-docker fa-fw fa-sm" aria-hidden=true></i> Guia rápido Docker</a></li></ul></li><li class=menu-item><a class=menu-link href=/sobre/><i class="fa-solid fa-user fa-fw fa-sm" aria-hidden=true></i> Sobre</a></li><li class=menu-item><a class=menu-link href=https://github.com/sidneiweber title=GitHub rel="noopener noreferrer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a></li><li class="menu-item menu-system"><span class="menu-system-item theme-switch" title="Trocar tema"><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></span><span class="menu-system-item language-switch">
<span role=button aria-label="Selecione o idioma" title="Selecione o idioma">Português<i class="dropdown-icon fa-solid fa-chevron-down" aria-hidden=true></i></span>
<select class=language-select onchange="location=this.value"><option disabled>Não há mais traduções</option></select></span></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container><aside class=toc id=toc-auto><h2 class=toc-title>Conteúdos&nbsp;<i class="toc-icon fa-solid fa-angle-down fa-fw" aria-hidden=true></i></h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><div class=header><h1 class="single-title animate__animated animate__flipInX"><span>Como utilizar o Traefik como ingress controller no Kubernetes</span></h1></div><div class=post-meta><div class=post-meta-line><span class=post-author><span class=author><i class="fa-solid fa-user-circle" aria-hidden=true></i>
Sidnei Weber</span></span></div><div class=post-meta-line><span title="publicado em 2024-03-22 10:20:00"><i class="fa-regular fa-calendar-alt fa-fw me-1" aria-hidden=true></i><time datetime=22/03/2024>22/03/2024</time></span>&nbsp;<span title="Atualizado em 2024-03-22 10:20:00"><i class="fa-regular fa-edit fa-fw me-1" aria-hidden=true></i><time datetime=22/03/2024>22/03/2024</time></span>&nbsp;<span title="1211 palavras"><i class="fa-solid fa-pencil-alt fa-fw me-1" aria-hidden=true></i></span>&nbsp;<span><i class="fa-regular fa-clock fa-fw me-1" aria-hidden=true></i>6 minutos</span>&nbsp;</div></div><div class=featured-image><img loading=lazy src=/como-utilizar-traefik-ingress-controller-no-kubernetes/featured-image.png data-title=" O Traefik é uma ferramenta muito poderosa e uma ótima alternativa para utilizar como ingress controller/proxy reverso em seu cluster Kubernetes. Uma ferramenta super leve, escrita em go e com diversas funcionalidades adicionais incluídas por padrão " data-alt=/como-utilizar-traefik-ingress-controller-no-kubernetes/featured-image.png style="background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></div><div class="details toc" id=toc-static data-kept=false><div class="details-summary toc-title"><span>Conteúdos</span>
<span><i class="details-icon fa-solid fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#o-que-é-traefik>O que é Traefik</a></li><li><a href=#instalando-traefik>Instalando Traefik</a><ul><li><a href=#pré-requisitos>Pré-requisitos</a></li><li><a href=#instalação-do-traefik>Instalação do Traefik</a></li><li><a href=#testando>Testando</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=o-que-é-traefik>O que é Traefik</h2><p>Traefik (pronuncia-se “traffic”) é um proxy reverso e balanceador de carga para microsserviços de código aberto. Traefik pode nos ajudar a subir serviços mais rapidamente sem barrar no excesso de configurações de infra e simplificar o ambiente. Ele é escrito em go e é super leve e rápido, como exemplo a imagem docker possui 43MB <a href="https://hub.docker.com/layers/library/traefik/latest/images/sha256-00cefa1183ba9d8972b24cca4f53f52cad38599ac01f225d11da004ac907c2db?context=explore" target=_blank rel="external nofollow noopener noreferrer">imagem-latest</a>.</p><p>Alguns recursos úteis que o Traefik nos disponibiliza:</p><ul><li>Auto Discovery</li><li>Metrics</li><li>SSL</li><li>Dashboard</li><li>Circuit breakers (LatencyAtQuantileMS, NetworkErrorRatio, ResponseCodeRatio)</li><li>Rate Limit</li><li>Retry (Enable retry sending request if network error)</li><li>Sticky sessions</li><li>Health Check</li><li>Canary deployments (Kubernetes)</li><li>Mirroring (Kubernetes)</li></ul><p><figure><a class=lightgallery href="/como-utilizar-traefik-ingress-controller-no-kubernetes/traefik.png?size=large" data-thumbnail="/como-utilizar-traefik-ingress-controller-no-kubernetes/traefik.png?size=small" data-sub-html="<h2>Traefik</h2><p>Traefik</p>"><img loading=lazy src=/como-utilizar-traefik-ingress-controller-no-kubernetes/traefik.png srcset="/como-utilizar-traefik-ingress-controller-no-kubernetes/traefik.png?size=small, /como-utilizar-traefik-ingress-controller-no-kubernetes/traefik.png?size=medium 1.5x, /como-utilizar-traefik-ingress-controller-no-kubernetes/traefik.png?size=large 2x" sizes=auto data-title=Traefik data-alt=Traefik style="--width:647px;--aspect-ratio:647 / 348;background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>Traefik</figcaption></figure></p><h2 id=instalando-traefik>Instalando Traefik</h2><h3 id=pré-requisitos>Pré-requisitos</h3><p>Precisamos obviamente de um cluster Kubernetes, para nosso exemplo utilizaremos um cluster EKS na AWS, se você não sabe como criar um cluster na AWS pode dar uma olhada <a href=https://sidneiweber.com.br/como-criar-cluster-kubernetes-eks-na-aws-com-eksctl/ target=_blank rel="external nofollow noopener noreferrer">nesse artigo</a> que escrevi. Também precisaremos de duas ferramentas instaladas:</p><ul><li>helm</li><li>kubectl</li></ul><p>Caso ainda não conheça o helm, sugiro dar uma lida nesse artigo da Red Hat: <a href=https://www.redhat.com/pt-br/topics/devops/what-is-helm target=_blank rel="external nofollow noopener noreferrer">https://www.redhat.com/pt-br/topics/devops/what-is-helm</a></p><h3 id=instalação-do-traefik>Instalação do Traefik</h3><p>Primeiro vamos criar um arquivo yaml onde iremos declarar alguns ajustes referentes ao traefik e que iremos utilizar durante a instalação. Editando o arquivo <code>traefik-values.yaml</code>:</p><div class=highlight id=id-1><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>ingressClass</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>isDefaultClass</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>fallbackApiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>ingressRoute</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>dashboard</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>service.beta.kubernetes.io/aws-load-balancer-type</span><span class=p>:</span><span class=w> </span><span class=l>nlb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>globalArguments</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=s2>&#34;--api.insecure=true&#34;</span></span></span></code></pre></td></tr></table></div></div><p>Bom o arquivo aqui é autodeclarativo, mas basicamente estamos dizendo para que durante a instalação seja criado o ingressClass do traefik no nosso cluster e o mesmo, seja utilizado como padrão. Também estamos desabilitando a rota para acessar o dashboard (configuraremos isso em outro post) e também estamos indicando que o tipo de balanceador de carga que iremos utilizar, e aqui será do tipo NLB (Network Load Balancer). Para mais detalhes sobe os valores disponíveis, podemos acessar o arquivo <a href=https://github.com/traefik/traefik-helm-chart/blob/master/traefik/values.yaml target=_blank rel="external nofollow noopener noreferrer">https://github.com/traefik/traefik-helm-chart/blob/master/traefik/values.yaml</a>.</p><p>Com nosso arquivo em mãos podemos prosseguir adicionando o repositório helm do Traefik, seguido da atualização dos repositórios e a instalação do Traefik.</p><div class=highlight id=id-2><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ helm repo add traefik https://helm.traefik.io/traefik
</span></span><span class=line><span class=cl>➜ helm repo update
</span></span><span class=line><span class=cl>➜ helm install traefik traefik/traefik --create-namespace --namespace<span class=o>=</span>traefik --values<span class=o>=</span>traefik-values.yaml</span></span></code></pre></td></tr></table></div></div><h3 id=testando>Testando</h3><p>Se nenhum erro ocorreu durante o processo já teremos o Traefik instalado e pronto para ser testado. Primeiramente vamos verificar os recursos criados durante a instalação em nosso cluster.</p><div class=highlight id=id-3><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ kubectl get all -n traefik
</span></span><span class=line><span class=cl>NAME                           READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>pod/traefik-6b894fd4d7-m9b7k   1/1     Running   <span class=m>0</span>          60s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME              TYPE           CLUSTER-IP      EXTERNAL-IP                                                                     PORT<span class=o>(</span>S<span class=o>)</span>                      AGE
</span></span><span class=line><span class=cl>service/traefik   LoadBalancer   10.100.235.23   a07cb2aa5c1384a14801dfee6b2dee7c-921b181b479547f4.elb.us-east-1.amazonaws.com   80:32181/TCP,443:32292/TCP   61s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment.apps/traefik   1/1     <span class=m>1</span>            <span class=m>1</span>           61s
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>NAME                                 DESIRED   CURRENT   READY   AGE
</span></span><span class=line><span class=cl>replicaset.apps/traefik-6b894fd4d7   <span class=m>1</span>         <span class=m>1</span>         <span class=m>1</span>       61s</span></span></code></pre></td></tr></table></div></div><p>Podemos verificar que diversos recursos foram criados, mas gostaria de destacar o <code>service</code> criado e automaticamente associado a uma load balancer na AWS, conforme solicitamos no nosso arquivo <code>traefik-values.yaml</code>. É através desse load balancer que faremos todas as nossas requisições para o cluster.</p><p>Por desencargo de consciência vamos tentar o acesso ao endereço:</p><div class=highlight id=id-4><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ curl a07cb2aa5c1384a14801dfee6b2dee7c-921b181b479547f4.elb.us-east-1.amazonaws.com
</span></span><span class=line><span class=cl><span class=m>404</span> page not found</span></span></code></pre></td></tr></table></div></div><p>Ao acessar nosso endereço recebemos um erro 404, mas até aí tudo bem, esse é um erro esperado. Ainda não temos nenhum serviço dentro cluster e a resposta padrão do Traefik quando não encontra nenhum serviço é de fato retornar um erro 404.</p><p>Para termos certeza que tudo vai funcionar como esperado, vamos adicionar um serviço e associar a ele uma regra de acesso. Vamos criar o arquivo <code>2048.yaml</code>.</p><div class=highlight id=id-5><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>deployment-2048</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>app-2048</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>app-2048</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>alexwhen/docker-2048</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>app-2048</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service-2048</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>NodePort</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>app-2048</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>traefik.containo.us/v1alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>IngressRoute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=m>2048</span>-<span class=l>ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class=l>traefik</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>entryPoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>match</span><span class=p>:</span><span class=w> </span><span class=l>PathPrefix(`/`)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>service-2048</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span></span></span></code></pre></td></tr></table></div></div><p>Para nosso exemplo vamos nos atentar principalmente ao último bloco do arquivo onde ficam as configurações específicas do Traefik. Configuramos aqui uma regra (Rule) onde os acessos ao cluster que acessem na rota principal (/), ou seja, o próprio endereço do cluster será redirecionado para o serviço que criamos. Essa regra poderia ser um path especifico assim como um endereço ou sub domínio, mais exemplos na <a href=https://doc.traefik.io/traefik/routing/routers/ target=_blank rel="external nofollow noopener noreferrer">documentação</a>.</p><p>Vamos conferir se o serviço subiu corretamente:</p><div class=highlight id=id-6><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ kubectl get deploy                     
</span></span><span class=line><span class=cl>NAME              READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>deployment-2048   1/1     <span class=m>1</span>            <span class=m>1</span>           11m</span></span></code></pre></td></tr></table></div></div><p>Para garantir também vamos dar aquela conferida na nossa regra criada para o Traefik.</p><div class=highlight id=id-7><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ kubectl get ingressroute
</span></span><span class=line><span class=cl>NAME           AGE
</span></span><span class=line><span class=cl>2048-ingress   11m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>➜ kubectl describe ingressroute 2048-ingress 
</span></span><span class=line><span class=cl>Name:         2048-ingress
</span></span><span class=line><span class=cl>Namespace:    default
</span></span><span class=line><span class=cl>Labels:       &lt;none&gt;
</span></span><span class=line><span class=cl>Annotations:  kubernetes.io/ingress.class: traefik
</span></span><span class=line><span class=cl>API Version:  traefik.containo.us/v1alpha1
</span></span><span class=line><span class=cl>Kind:         IngressRoute
</span></span><span class=line><span class=cl>Metadata:
</span></span><span class=line><span class=cl>  Creation Timestamp:  2024-03-21T18:40:48Z
</span></span><span class=line><span class=cl>  Generation:          <span class=m>4</span>
</span></span><span class=line><span class=cl>  Resource Version:    <span class=m>6036</span>
</span></span><span class=line><span class=cl>  UID:                 31b125f9-b7e9-40ec-a367-352d8fc76de7
</span></span><span class=line><span class=cl>Spec:
</span></span><span class=line><span class=cl>  Entry Points:
</span></span><span class=line><span class=cl>    web
</span></span><span class=line><span class=cl>  Routes:
</span></span><span class=line><span class=cl>    Kind:   Rule
</span></span><span class=line><span class=cl>    Match:  PathPrefix<span class=o>(</span><span class=sb>`</span>/<span class=sb>`</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    Services:
</span></span><span class=line><span class=cl>      Name:  service-2048
</span></span><span class=line><span class=cl>      Port:  <span class=m>80</span>
</span></span><span class=line><span class=cl>Events:      &lt;none&gt;</span></span></code></pre></td></tr></table></div></div><p>Bom, então agora só nos falta o teste final, vamos tentar abrir o endereço do load balancer diretamente no navegador:</p><p><figure><a class=lightgallery href="/como-utilizar-traefik-ingress-controller-no-kubernetes/2048.png?size=large" data-thumbnail="/como-utilizar-traefik-ingress-controller-no-kubernetes/2048.png?size=small" data-sub-html="<h2>Serviço rodando</h2><p>Serviço rodando</p>"><img loading=lazy src=/como-utilizar-traefik-ingress-controller-no-kubernetes/2048.png srcset="/como-utilizar-traefik-ingress-controller-no-kubernetes/2048.png?size=small, /como-utilizar-traefik-ingress-controller-no-kubernetes/2048.png?size=medium 1.5x, /como-utilizar-traefik-ingress-controller-no-kubernetes/2048.png?size=large 2x" sizes=auto data-title="Serviço rodando" data-alt="Serviço rodando" style="--width:794px;--aspect-ratio:794 / 951;background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>Serviço rodando</figcaption></figure></p><p>E pronto, aí está nosso serviço sendo exposto através do Traefik. Poderíamos deixar nosso Traefik mais parrudo, adicionando certificado, criando regras especificas, adicionando health check e outros recursos que o Traefik disponibiliza, mas vamos deixar para um próximo artigo.</p><p>Mas antes de irmos embora vamos criar um novo serviço e ver como a coisa fica muito simples e que realmente funciona. Vamos criar o arquivo <code>whoami.yaml</code> e seu conteúdo será muito parecido com o outro serviço, obviamente mudando a regra para acesso ao serviço.</p><div class=highlight id=id-8><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>traefik/whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>traefik.containo.us/v1alpha1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>IngressRoute</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami-ingress</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>annotations</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>kubernetes.io/ingress.class</span><span class=p>:</span><span class=w> </span><span class=l>traefik</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>entryPoints</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>web</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>routes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>match</span><span class=p>:</span><span class=w> </span><span class=l>PathPrefix(`/whoami`)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Rule</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>whoami</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span></span></span></code></pre></td></tr></table></div></div><p>E vamos criar os recursos:</p><div class=highlight id=id-9><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl apply -f whoami.yaml</span></span></code></pre></td></tr></table></div></div><p>Vamos direto conferir que nosso ingressRoute foi criado:</p><div class=highlight id=id-10><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ kubectl get ingressroute
</span></span><span class=line><span class=cl>NAME             AGE
</span></span><span class=line><span class=cl>2048-ingress     23m
</span></span><span class=line><span class=cl>whoami-ingress   3m26s</span></span></code></pre></td></tr></table></div></div><p>Novamente vamos aos testes, agora cuidando para acessar pelo mesmo endereço e na rota <code>/whoami</code>.</p><div class=highlight id=id-11><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>➜ curl http://a07cb2aa5c1384a14801dfee6b2dee7c-921b181b479547f4.elb.us-east-1.amazonaws.com/whoami
</span></span><span class=line><span class=cl>Hostname: whoami-697f8c6cbc-4cbgp
</span></span><span class=line><span class=cl>IP: 127.0.0.1
</span></span><span class=line><span class=cl>IP: ::1
</span></span><span class=line><span class=cl>IP: 192.168.19.98
</span></span><span class=line><span class=cl>IP: fe80::7c11:eeff:fe2c:5156
</span></span><span class=line><span class=cl>RemoteAddr: 192.168.2.114:41940
</span></span><span class=line><span class=cl>GET /whoami HTTP/1.1
</span></span><span class=line><span class=cl>Host: a07cb2aa5c1384a14801dfee6b2dee7c-921b181b479547f4.elb.us-east-1.amazonaws.com
</span></span><span class=line><span class=cl>User-Agent: curl/7.88.1
</span></span><span class=line><span class=cl>Accept: */*
</span></span><span class=line><span class=cl>Accept-Encoding: gzip
</span></span><span class=line><span class=cl>X-Forwarded-For: 192.168.3.224
</span></span><span class=line><span class=cl>X-Forwarded-Host: a07cb2aa5c1384a14801dfee6b2dee7c-921b181b479547f4.elb.us-east-1.amazonaws.com
</span></span><span class=line><span class=cl>X-Forwarded-Port: <span class=m>80</span>
</span></span><span class=line><span class=cl>X-Forwarded-Proto: http
</span></span><span class=line><span class=cl>X-Forwarded-Server: traefik-6b894fd4d7-m9b7k
</span></span><span class=line><span class=cl>X-Real-Ip: 192.168.3.224</span></span></code></pre></td></tr></table></div></div><p><figure><a class=lightgallery href="/como-utilizar-traefik-ingress-controller-no-kubernetes/image.gif?size=large" data-thumbnail="/como-utilizar-traefik-ingress-controller-no-kubernetes/image.gif?size=small" data-sub-html="<h2>That&amp;rsquo;s It</h2><p>That's It</p>"><img loading=lazy src=/como-utilizar-traefik-ingress-controller-no-kubernetes/image.gif srcset="/como-utilizar-traefik-ingress-controller-no-kubernetes/image.gif?size=small, /como-utilizar-traefik-ingress-controller-no-kubernetes/image.gif?size=medium 1.5x, /como-utilizar-traefik-ingress-controller-no-kubernetes/image.gif?size=large 2x" sizes=auto data-title="That's It" data-alt="That&amp;rsquo;s It" style="--width:499px;--aspect-ratio:499 / 366;background:url(/svg/loading.min.svg)no-repeat 50%" onload='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e);this.dataset.lazyloaded=""' onerror='this.title=this.dataset.title,this.alt=this.dataset.alt;for(const e of["style","data-title","data-alt","onerror","onload"])this.removeAttribute(e)'></a><figcaption class=image-caption>That&rsquo;s It</figcaption></figure></p><p><a href=https://traefik.io/blog/eks-clusters-with-traefik-proxy-as-the-ingress-controller/ target=_blank rel="external nofollow noopener noreferrer">https://traefik.io/blog/eks-clusters-with-traefik-proxy-as-the-ingress-controller/</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="Atualizado em 2024-03-22 10:20:00">Atualizado em 22/03/2024&nbsp;</span></div><div class=post-info-license><span><a rel="license external nofollow noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a href=/como-utilizar-traefik-ingress-controller-no-kubernetes/index.md title="Leia em Markdown" class=link-to-markdown>Leia em Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Compartilhe em Twitter" data-sharer=twitter data-url=https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/ data-title="Como utilizar o Traefik como ingress controller no Kubernetes" data-hashtags=k8s,kubernetes,eks,traefik,ingress><i class="fa-brands fa-twitter fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Facebook" data-sharer=facebook data-url=https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/ data-hashtag=k8s><i class="fa-brands fa-facebook-square fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Linkedin" data-sharer=linkedin data-url=https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/><i class="fa-brands fa-linkedin fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em WhatsApp" data-sharer=whatsapp data-url=https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/ data-title="Como utilizar o Traefik como ingress controller no Kubernetes" data-web><i class="fa-brands fa-whatsapp fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Evernote" data-sharer=evernote data-url=https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/ data-title="Como utilizar o Traefik como ingress controller no Kubernetes"><i class="fa-brands fa-evernote fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); title="Compartilhe em Trello" data-sharer=trello data-url=https://sidneiweber.com.br/como-utilizar-traefik-ingress-controller-no-kubernetes/ data-title="Como utilizar o Traefik como ingress controller no Kubernetes" data-description=" O Traefik é uma ferramenta muito poderosa e uma ótima alternativa para utilizar como ingress controller/proxy reverso em seu cluster Kubernetes. Uma ferramenta super leve, escrita em go e com diversas funcionalidades adicionais incluídas por padrão "><i class="fa-brands fa-trello fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fa-solid fa-tags fa-fw me-1" aria-hidden=true></i><a href=/tags/k8s/ class=post-tag>K8s</a><a href=/tags/kubernetes/ class=post-tag>Kubernetes</a><a href=/tags/eks/ class=post-tag>Eks</a><a href=/tags/traefik/ class=post-tag>Traefik</a><a href=/tags/ingress/ class=post-tag>Ingress</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Voltar</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/criando-api-rest-em-python-com-flask/ class=post-nav-item rel=prev title="Criando uma API REST em Python com Flask"><i class="fa-solid fa-angle-left fa-fw" aria-hidden=true></i>Criando uma API REST em Python com Flask</a>
<a href=/4-alternativas-ao-redis/ class=post-nav-item rel=next title="4 Alternativas ao Redis">4 Alternativas ao Redis<i class="fa-solid fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript rel="external nofollow noopener noreferrer">Disqus</a>.</noscript></div></article></main><footer class=footer><div class=footer-container><div class="footer-line powered">Possibilitado por <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreferrer" title="Hugo 0.133.1">Hugo</a> | Tema - <a href=https://github.com/hugo-fixit/FixIt target=_blank rel=external title="FixIt v0.2.18-lts.5"><img class=fixit-icon src=/fixit.min.svg alt="FixIt logo">&nbsp;FixIt</a></div><div class="footer-line copyright" itemscope itemtype=http://schema.org/CreativeWork><i class="fa-regular fa-copyright fa-fw" aria-hidden=true></i>
<span itemprop=copyrightYear>2009 - 2024</span><span class=author itemprop=copyrightHolder>
<a href=/>Sidnei Weber</a></span><span class="license footer-divider"><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class="footer-line statistics"></div></div></footer></div><div class=widgets><div class="fixed-buttons animate__faster d-none"><div class="fixed-button back-to-top" role=button aria-label="Voltar ao topo"><i class="fa-solid fa-arrow-up fa-fw" aria-hidden=true></i><span class="variant-numeric d-none">0%</span></div><div class="fixed-button view-comments d-none" role=button aria-label="Ver comentários"><i class="fa-solid fa-comment fa-fw" aria-hidden=true></i></div></div><div id=mask></div><noscript><div class=noscript-warning></div></noscript></div><script src=https://sidneiweber.disqus.com/embed.js defer></script><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js defer></script><script src=/lib/lunr/lunr.stemmer.support.min.js defer></script><script src=/lib/lunr/lunr.pt.min.js defer></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js async defer></script><script src=https://cdn.jsdelivr.net/npm/typeit@8.7.1/dist/index.umd.js defer></script><script>window.config={code:{copyTitle:"Copiar para a área de transferência",editLockTitle:"Bloquear bloco de código editável",editUnLockTitle:"Desbloqueie o bloco de código editável",editable:!0,maxShownLines:50},comment:{enable:!0,expired:!1},data:{"typeit-header-desktop":"Sidnei Weber","typeit-header-title-mobile":"Sidnei Weber"},search:{highlightTag:"em",lunrIndexURL:"/index.json",lunrLanguageCode:"pt",maxResultLength:10,noResultsFound:"Nenhum resultado encontrado",snippetLength:30,type:"lunr"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"typeit-header-desktop":["typeit-header-desktop"],"typeit-header-title-mobile":["typeit-header-title-mobile"]},duration:-1,loop:!1,speed:100}}</script><script src=/js/theme.min.js defer></script></body></html>